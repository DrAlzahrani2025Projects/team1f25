FROM python:3.12-slim

WORKDIR /app

# Copy requirements and install dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt && \
    pip install --no-cache-dir pytest pytest-mock pytest-cov

# Copy application code
COPY app.py .
COPY core/ core/
COPY ui/ ui/

# Copy test infrastructure
COPY tests/ tests/
COPY pytest.ini .
COPY run_tests.py .
COPY run_pytest.py .

# Set environment variables for testing
ENV PYTHONPATH=/app

# Default command to run new pytest-based tests
# Can be overridden at runtime:
#   docker run <image> python run_pytest.py unit
#   docker run <image> python run_pytest.py integration
#   docker run <image> python run_pytest.py all
#   docker run <image> python run_pytest.py legacy
CMD ["python", "run_pytest.py", "all"]