# --- Streamlit reverse proxy for team1f25 ---
ProxyRequests Off

<Proxy "*">
    Require all granted
</Proxy>

RewriteEngine On
# Normalize missing trailing slash: /team1f25 -> /team1f25/
RewriteRule ^/team1f25$ /team1f25/ [R=301,L]
# Normalize missing trailing slash: /team1f25-jupyter -> /team1f25-jupyter/
RewriteRule ^/team1f25-jupyter$ /team1f25-jupyter/ [R=301,L]

# Core HTTP proxy (TRAILING SLASHES ARE IMPORTANT)
ProxyPass        /team1f25/ http://localhost:5001/team1f25/ retry=0 keepalive=On
ProxyPassReverse /team1f25/ http://localhost:5001/team1f25/

# WebSocket upgrade for Streamlit
RewriteCond %{HTTP:Upgrade} =websocket [NC]
RewriteCond %{HTTP:Connection} upgrade [NC]
RewriteRule ^/team1f25/(.*) ws://localhost:5001/team1f25/$1 [P,L]

# Jupyter proxy
ProxyPass        /team1f25-jupyter/ http://localhost:8888/team1f25-jupyter/ retry=0 keepalive=On
ProxyPassReverse /team1f25-jupyter/ http://localhost:8888/team1f25-jupyter/

# WebSocket upgrade for Jupyter
RewriteCond %{HTTP:Upgrade} =websocket [NC]
RewriteCond %{HTTP:Connection} upgrade [NC]
RewriteRule ^/team1f25-jupyter/(.*) ws://localhost:8888/team1f25-jupyter/$1 [P,L]

# Preserve scheme info for the app
RequestHeader set X-Forwarded-Proto "https"
# --- End Streamlit reverse proxy for team1f25 ---
